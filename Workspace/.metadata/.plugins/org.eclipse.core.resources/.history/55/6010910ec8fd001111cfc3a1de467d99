mongoose = require('mongoose')
###
Database middleware class that handles connection setup and exposes available data models.
Creating multiple instances of this class will create a new connection for each instance; therefore, 
the application only spins up one copy of this class at startup and exposes a global variable named QRefDatabase 
which is reused through the application. The convience method {#instance} is used to grab a reference off of 
this global QRefDatabase variable. Only one connection to the MongoDB server is ever needed for the life of the 
application because all requests to mongo occur in an evented manner and a single connection object can handle 
multiple requests at a time. 

@example Getting a reference from QRefDatabase global variable
  db = QRefDatabase.instance()

@author Nathan Klick
@copyright QRef 2012
###
class QRefDatabase
	connection: null
	url: 'mongodb://qref:qref@localhost/qref'
	User: null
	AuthToken: null
	Role: null
	RecoveryQuestion: null
	AircraftManufacturer: null
	AircraftModel: null
	AircraftChecklist: null
	Product: null
	UserProduct: null
	Schema: mongoose.Schema
	constructor: () ->
		@connection = mongoose.createConnection(@url)
		@.initialize()
	initialize: () ->
		RoleSchema = require('../schema/RoleSchema')
		@Role = @connection.model('user.roles', RoleSchema)
		RecoveryQuestionSchema = require('../schema/RecoveryQuestionSchema')
		@RecoveryQuestion = @connection.model('user.recovery.questions', RecoveryQuestionSchema)
		UserSchema = require('../schema/UserSchema')
		@User = @connection.model('users', UserSchema)
		AuthTokenSchema = require('../schema/AuthTokenSchema')
		@AuthToken = @connection.model('user.tokens', AuthTokenSchema)
		AircraftManufacturerSchema = require('../schema/AircraftManufacturerSchema')
		@AircraftManufacturer = @connection.model('aircraft.manufacturers', AircraftManufacturerSchema)
		AircraftModelSchema = require('../schema/AircraftModelSchema')
		@AircraftModel = @connection.model('aircraft.models', AircraftModelSchema)
		AircraftChecklistSchema = require('../schema/AircraftChecklistSchema')
		@AircraftChecklist = @connection.model('aircraft.checklists', AircraftChecklistSchema)
		ProductSchema = require('../schema/ProductSchema')
		@Product = @connection.model('products', ProductSchema)
		UserProductSchema = require('../schema/UserProductSchema')
		@UserProduct = @connection.model('user.products', UserProductSchema)
	getConnection: () -> @connection
	getUrl: () -> @url
	instance: () -> @
module.exports = new QRefDatabase()
		